<!DOCTYPE html>

<html>

	<head>

		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

		<title>NYTimes Article Search</title>
		
		<link rel="stylesheet" type="text/css" href="css/NYTSearch.css">
		<link rel="stylesheet" type="text/css" href="css/jquery-ui-1.10.4.css">
		<link rel="shortcut icon" href="css/images/nytimesIcon.ico">
		
		<script src="jquery-1.10.2.js"></script>
		<script src="jquery-ui-1.10.4.js"></script>

		<script>
			$(function() {
			  var pageCount = 0;

			  $("#nextPageButton").click(function() {		
			  		pageCount++;
			  		
			  		// empty all the div's
			  		$('#pageNumber').empty();
			  		for (var i = 0; i < 10; i++) {
						$('#newsItem'+i).empty();
					}
					searching();
				  	// prevent default submit action
	    			return false;

  				});//click button

  				$("#prevPageButton").click(function(){
			  		pageCount--;
			  		
			  		// empty all the div's
			  		$('#pageNumber').empty();
			  		for (var i = 0; i < 10; i++) {
						$('#newsItem'+i).empty();
					}
					searching();
				  	// prevent default submit action
	    			return false;

  				});//click button

  			// function that is calles when "next page" or "prev page" are clicked
  			function searching(){
  				var key = "a88ece958afce75643acb9a7cfc38fc3:15:68057138";
			   	var searchTerm = $("#searchTerm").val();
			   	var beginDate = $("#altBeginDate").val();
			   	var endDate = $("#altEndDate").val();

			   	// prvevent pageCount be negative
			   	if (pageCount < 0){
			   		pageCount = 0;
			   	}

			   	// create query string
			    var dataString = 'q='+searchTerm + '&page='+pageCount + 
			    '&begin_date='+ beginDate +'&end_date='+endDate + 
			    '&sort=newest' +'&api-key='+key;
			    
			    $.ajax({
				      type: "GET",
				      url: 'http://api.nytimes.com/svc/search/v2/articlesearch.json',
				      data: dataString,

				      success: function(result) {
				      	//console.log(result);
				      	$('#pageNumber').empty();
				      	$('#pageNumberBottom').empty();
				  		for (var i = 0; i < 10; i++) {
							$('#newsItem'+i).empty();
						}

				      	var article = result.response.docs;
				      	for (var i = 0, len = article.length; i < len; i++) {
  							var link = article[i].web_url;
  							var headline = article[i].headline.main;
  							$('#newsItem'+i).append('<a href='+ link +'>'+ headline +"</a>");
						}
						$('#pageNumber').append('page '+ (pageCount+1));
						$('#pageNumberBottom').append('page '+ (pageCount+1));

				      },

				      error: function(xhr, textStatus, error){
				      		console.log('error'+ error);
						if (textStatus == "error") {

							 $("#newsItem0").empty();

							 $("#newsItem0").append("The requested page was: " + this.url + "<br>The error number returned was: " + xhr.status + "<br>The error message was: " + xhr.statusText );

						}

					}
    			});//ajax

			    // prevent default submit action
    			return false;
  			}

			  $("#searchButton").click(function(){
				    // define query parameters
				    var key = "a88ece958afce75643acb9a7cfc38fc3:15:68057138";
				   	var searchTerm = $("#searchTerm").val();
				   	var beginDate = $("#altBeginDate").val();
				   	var endDate = $("#altEndDate").val();

				   	// set to 0 to get to the 1st page when pressing search;
				   	pageCount = 0;

				   	// create query string
				    var dataString = 'q='+searchTerm + '&page='+pageCount + 
				    '&begin_date='+ beginDate +'&end_date='+endDate + 
				    '&sort=newest' +'&api-key='+key;
				    
				    $.ajax({
					      type: "GET",
					      url: 'http://api.nytimes.com/svc/search/v2/articlesearch.json',
					      data: dataString,

					      success: function(result) {
					      	//console.log(result);
					      	$('#pageNumber').empty();
					      	$('#pageNumberBottom').empty();
					  		for (var i = 0; i < 10; i++) {
								$('#newsItem'+i).empty();
							}

					      	var article = result.response.docs;
					      	for (var i = 0, len = article.length; i < len; i++) {
									var link = article[i].web_url;
									var headline = article[i].headline.main;
									$('#newsItem'+i).append('<a href='+ link +'>'+ headline +"</a>");
							}
							$('#pageNumber').append('page '+ (pageCount+1));
							$('#pageNumberBottom').append('page '+ (pageCount+1));

					      },

					      error: function(xhr, textStatus, error){
					      		console.log('error'+ error);
							if (textStatus == "error") {

								 $("#newsItem0").empty();

								 $("#newsItem0").append("The requested page was: " + this.url + "<br>The error number returned was: " + xhr.status + "<br>The error message was: " + xhr.statusText );
							}

						}
					});//ajax

				    // prevent default submit action
					return false;
			
  			});//click button
		});

		</script>


		<script>
			// datepicker
        	$(function(){
        		$.datepicker.setDefaults({
					  showOn: "both",
					  buttonImageOnly: true,
					  buttonImage: "css/images/calendar-blue.png",
					  showAnim: 'slideDown',
					  duration: 'fast'
					});
			
				$("#beginDate").datepicker({
					dateFormat: 'mm/dd/yy',
					// to change to NYT format yymmdd
					altFormat: "yymmdd",
					altField: "#altBeginDate"
				});
				
				$( "#endDate" ).datepicker({
					buttonImage: 'css/images/calendar-blue.png',
					dateFormat: 'mm/dd/yy',
					altFormat: "yymmdd",
					altField: "#altEndDate"
				});

			});
		</script>

	</head>


 	<body>
	 	<div id="mainBox">
	 		<div id="secondaryBox">

				<div class="heading">
				<a href="http://www.nytimes.com/"><img src="css/images/nytimesLogo.gif"></a><br>
					Articles Search
				</div>
				
				<div id="forBackground">
		        <form class="dataInput" id="dataInput" role="search">
		        
		            <input type="text" placeholder=" search term" name="searchTerm" id="searchTerm" value="" required/>

		            <input type="text" data-type="date" placeholder=" begin date" name="beginDate" id="beginDate"/>
		           
		            <input type="text" data-type="date" placeholder=" end date" id="endDate"/>

		            <button class="button" id="searchButton" type="submit">Search</button>
		            <!-- Change the date format behind the scene -->
		            <div id="altBeginDate"></div> <div id="altEndDate"></div>
		        </form><br>

		        
				<button class="button" id="prevPageButton" type="submit">Prev Page</button>
				<div id="pageNumber"></div> 
				<button class="button" id="nextPageButton" type="submit">Next Page</button><br><br>
				

				<div class="news" id="newsItem0"></div><br>

				<div class="news" id="newsItem1"></div><br>

				<div class="news" id="newsItem2"></div><br>

				<div class="news" id="newsItem3"></div><br>

				<div class="news" id="newsItem4"></div><br>

				<div class="news" id="newsItem5"></div><br>

				<div class="news" id="newsItem6"></div><br>

				<div class="news" id="newsItem7"></div><br>

				<div class="news" id="newsItem8"></div><br>

				<div class="news" id="newsItem9"></div><br>

				
				<div id="pageNumberBottom"></div>
			
			</div>
			</div>
		</div>

 	</body>

